{% extends "base.html" %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-white">Admin Analytics</h1>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-white">Points Distribution by Category</h2>
        <canvas id="categoryPointsChart"></canvas>
    </div>

    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-white">Points Distribution by User</h2>
        <canvas id="userPointsChart"></canvas>
    </div>
</div>

<div class="mt-6 bg-gray-800 p-6 rounded-lg shadow-lg">
    <h2 class="text-xl font-semibold mb-4 text-white">Challenges Solved Over Time</h2>
    <canvas id="challengesSolvedChart"></canvas>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Data for Category Points Chart
        const categoryLabels = {{ category_labels | tojson }};
        const categoryValues = {{ category_values | tojson }};

        const categoryCtx = document.getElementById('categoryPointsChart').getContext('2d');
        new Chart(categoryCtx, {
            type: 'pie',
            data: {
                labels: categoryLabels,
                datasets: [{
                    data: categoryValues,
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40',
                        '#E7E9ED', '#8AC926', '#FFCA3A', '#1982C4', '#6A4C93', '#F45B69'
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: {
                            color: 'white' // Set legend text color to white
                        }
                    }
                }
            }
        });

        // Data for User Points Chart
        const userLabels = {{ user_labels | tojson }};
        const userValues = {{ user_values | tojson }};

        const userCtx = document.getElementById('userPointsChart').getContext('2d');
        new Chart(userCtx, {
            type: 'pie',
            data: {
                labels: userLabels,
                datasets: [{
                    data: userValues,
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40',
                        '#E7E9ED', '#8AC926', '#FFCA3A', '#1982C4', '#6A4C93', '#F45B69'
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false // Hide the legend
                    }
                }
            }
        });

        // Data for Challenges Solved Over Time Chart
        const solvedDates = {{ solved_dates | tojson }};
        const solvedCounts = {{ solved_counts | tojson }};

        const challengesSolvedCtx = document.getElementById('challengesSolvedChart').getContext('2d');
        new Chart(challengesSolvedCtx, {
            type: 'line',
            data: {
                labels: solvedDates,
                datasets: [{
                    label: 'Challenges Solved',
                    data: solvedCounts,
                    borderColor: '#36A2EB',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: {
                            color: 'white'
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day',
                            tooltipFormat: 'MMM d, YYYY',
                            displayFormats: {
                                day: 'MMM d'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Date',
                            color: 'white'
                        },
                        ticks: {
                            color: 'white'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Challenges Solved',
                            color: 'white'
                        },
                        ticks: {
                            color: 'white'
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}