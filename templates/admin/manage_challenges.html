{% extends "base.html" %}
{% block content %}
    <h1 class="theme-page-title text-3xl font-bold mb-6">Manage Challenges</h1>
    <p class="mb-4"><a href="{{ url_for('admin.new_challenge') }}" class="theme-modal-button-primary font-bold py-2 px-4 rounded shadow-md">Create New Challenge</a></p>
    <div class="overflow-x-auto theme-card">
        <table id="challenges-table" class="min-w-full theme-table">
            <thead>
                <tr>
                    <th class="px-5 py-3 border-b-2 theme-table-header-cell text-left text-xs font-semibold uppercase tracking-wider">
                        ID
                    </th>
                    <th class="px-5 py-3 border-b-2 theme-table-header-cell text-left text-xs font-semibold uppercase tracking-wider">
                        Name
                    </th>
                    <th class="px-5 py-3 border-b-2 theme-table-header-cell text-left text-xs font-semibold uppercase tracking-wider">
                        Category
                    </th>
                    <th class="px-5 py-3 border-b-2 theme-table-header-cell text-left text-xs font-semibold uppercase tracking-wider">
                        Points
                    </th>
                    <th class="px-5 py-3 border-b-2 theme-table-header-cell text-left text-xs font-semibold uppercase tracking-wider">
                        Unlock
                    </th>
                    <th class="px-5 py-3 border-b-2 theme-table-header-cell text-left text-xs font-semibold uppercase tracking-wider">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for data in challenges_data %}
                    {% set challenge = data.challenge %}
                    {% set row_class = '' %}
                    {% if data.is_red_stripe %}
                        {% set row_class = 'bg-red-900/50' %} {# Locked #}
                    {% elif data.is_orange_stripe %}
                        {% set row_class = 'bg-orange-900/50' %} {# Unlockable (No Solves) #}
                    {% elif data.is_yellow_stripe %}
                        {% set row_class = 'bg-yellow-900/50' %} {# Unlocked (0-50%) #}
                    {% elif data.is_blue_stripe %}
                        {% set row_class = 'bg-blue-900/50' %} {# Rarely Unlocked (50-90%) #}
                    {% endif %}
                    <tr class="{{ row_class }}">
                        <td class="px-5 py-5 text-sm theme-table-body-cell">
                            <p class="whitespace-no-wrap">{{ challenge.id }}</p>
                        </td>
                        <td class="px-5 py-5 text-sm theme-table-body-cell">
                            <p class="whitespace-no-wrap">{{ challenge.name }}
                                {% if challenge.has_dynamic_flag %}
                                    <span class="text-green-500">(Dynamic)</span>
                                {% endif %}
                            </p>
                        </td>
                        <td class="px-5 py-5 text-sm theme-table-body-cell">
                            <p class="whitespace-no-wrap">{{ challenge.category.name }}</p>
                        </td>
                        <td class="px-5 py-5 text-sm theme-table-body-cell">
                            <p class="whitespace-no-wrap">{{ challenge.points }}</p>
                        </td>
                        <td class="px-5 py-5 text-sm theme-table-body-cell">
                            {% if data.is_red_stripe %}
                                <span class="text-red-500"><i class="fas fa-lock mr-2"></i>Hidden/Locked</span>
                            {% elif challenge.unlock_type == 'NONE' %}
                                <span class="text-green-500"><i class="fas fa-unlock mr-2"></i>Always Unlocked</span>
                            {% elif challenge.unlock_type == 'TIMED' %}
                                <span class="text-blue-500"><i class="fas fa-clock mr-2"></i>Timed: {{ challenge.unlock_date_time.strftime('%Y-%m-%d %H:%M') }}</span>
                            {% elif challenge.unlock_type == 'PREREQUISITE_PERCENTAGE' %}
                                <span class="text-yellow-500"><i class="fas fa-puzzle-piece mr-2"></i>{{ challenge.prerequisite_percentage_value }}% of challenges</span>
                            {% elif challenge.unlock_type == 'PREREQUISITE_COUNT' %}
                                <span class="text-yellow-500"><i class="fas fa-puzzle-piece mr-2"></i>{{ challenge.prerequisite_count_value }} challenges</span>
                            {% elif challenge.unlock_type == 'PREREQUISITE_CHALLENGES' %}
                                <span class="text-yellow-500"><i class="fas fa-puzzle-piece mr-2"></i>Specific challenges</span>
                            {% else %}
                                <p class="whitespace-no-wrap">{{ challenge.unlock_type }} ({{ "%.2f" | format(data.unlocked_percentage) }}%)</p>
                            {% endif %}
                        </td>
                        <td class="px-5 py-5 text-sm theme-table-body-cell">
                            <a href="{{ url_for('admin.update_challenge', challenge_id=challenge.id) }}" class="theme-button-edit">Edit</a>
                            <form action="{{ url_for('admin.delete_challenge', challenge_id=challenge.id) }}" method="POST" class="inline-block">
                                <button type="submit" class="theme-button-delete" onclick="return confirm('Are you sure you want to delete this challenge?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-10">
                            <p class="text-gray-400">No challenges found. <a href="{{ url_for('admin.new_challenge') }}" class="text-blue-500 hover:underline">Create one?</a></p>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock content %}
